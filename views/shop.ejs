<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shop - BuildOnBudget</title>
  <link href="/output.css" rel="stylesheet" />
  <link href="/toast.css" rel="stylesheet" />
  <link rel="shortcut icon" href="/images/logo.png" type="image/x-icon" />
  <script defer src="/javascript/index.js"></script>
  <style>
    .card-hover {
      transition: all 0.3s ease;
    }
    .card-hover:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .animate-fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body class="bg-bg-primary text-text-primary min-h-screen flex flex-col">
  <div id="toast-container"></div>
  <div class="w-full bg-bg-primary text-text-primary min-h-screen flex flex-col items-center justify-center">
    <!-- Header -->
    <header class="w-full gradient-bg shadow-xl py-6">
      <div class="container mx-auto px-4 flex justify-between items-center">
        <div class="flex items-center space-x-3">
          <img src="/images/logo.png" alt="Logo" class="w-10 h-10 animate-pulse rounded-full border-2 border-white">
          <span class="text-2xl font-bold text-white">BuildOnBudget</span>
        </div>
        <nav class="flex space-x-8">
          <a href="/dashboard" class="text-white hover:text-yellow-300 transition duration-300 flex items-center space-x-2">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
          </a>
          <a href="/cart" class="relative text-white hover:text-yellow-300 transition duration-300 flex items-center space-x-2">
            <i class="fas fa-shopping-cart"></i>
            <span>Cart</span>
            <span id="cart-count" class="absolute -top-2 -right-2 bg-yellow-400 text-purple-900 text-xs rounded-full h-6 w-6 flex items-center justify-center font-bold animate-bounce">
              <%= cartCount %>
            </span>
          </a>
        </nav>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow w-full container mx-auto px-4 py-12">
      <div class="text-center mb-12">
        <h1 class="text-5xl font-extrabold mb-4 bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 bg-clip-text text-transparent animate-fade-in">
          üõ†Ô∏è Premium Construction Materials
        </h1>
        <p class="text-xl text-text-secondary max-w-2xl mx-auto">
          Discover top-quality materials for your next project. From tools to equipment, we've got everything you need.
        </p>
      </div>

      <!-- Search and Filter -->
      <div class="mb-12 flex flex-col md:flex-row gap-6 justify-center items-center">
        <div class="relative w-full md:w-1/3">
          <input type="text" id="search" placeholder="üîç Search materials..." class="w-full px-6 py-3 border-2 border-purple-200 rounded-full focus:outline-none focus:ring-4 focus:ring-purple-300 focus:border-purple-500 transition duration-300 shadow-lg">
          <i class="fas fa-search absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
        </div>
        <select id="category" class="px-6 py-3 border-2 border-purple-200 rounded-full focus:outline-none focus:ring-4 focus:ring-purple-300 focus:border-purple-500 transition duration-300 shadow-lg bg-white">
          <option value="">üéØ All Categories</option>
          <option value="tools">üîß Tools</option>
          <option value="materials">üèóÔ∏è Materials</option>
          <option value="equipment">‚öôÔ∏è Equipment</option>
        </select>
      </div>

      <!-- Items Grid -->
      <div id="items-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
        <% items.forEach(item => { %>
          <div class="bg-white rounded-2xl shadow-xl overflow-hidden card-hover animate-fade-in flex flex-col">
            <div class="relative">
            <img src="<%= item.media ? item.media.url : '/images/logo.png' %>" alt="<%= item.name %>" class="h-48 w-full object-cover" />
              <div class="absolute top-4 right-4 bg-white bg-opacity-90 rounded-full p-2 shadow-md">
                <i class="fas fa-star text-yellow-400"></i>
              </div>
            </div>
            <div class="p-6 flex flex-col flex-grow">
              <h3 class="text-xl font-bold mb-2 text-gray-800"><%= item.name %></h3>
              <p class="text-gray-600 mb-4 line-clamp-2 flex-grow"><%= item.description || 'High-quality construction material' %></p>
              <div class="flex justify-between items-center">
                <span class="text-2xl font-extrabold text-purple-600">$<%= parseFloat(item.price).toFixed(2) %></span>
                <button data-id="<%= item.id %>" class="add-to-cart-btn bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-2 rounded-full hover:from-purple-700 hover:to-pink-700 transition duration-300 transform hover:scale-105 shadow-lg">
                  <i class="fas fa-cart-plus mr-2"></i>Add to Cart
                </button>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    </main>

    <!-- Footer -->
    <footer class="w-full gradient-bg text-white text-center py-6">
      <div class="container mx-auto px-4">
        <p class="text-lg">&copy; <%= new Date().getFullYear() %> BuildOnBudget. Building dreams, one project at a time.</p>
      </div>
    </footer>
  </div>

  <script>
    const items = <%- JSON.stringify(items) %>;

    const itemsContainer = document.getElementById('items-grid');
    const searchInput = document.getElementById('search');
    const filterCategory = document.getElementById('category');

    function renderItems(filteredItems) {
      itemsContainer.innerHTML = '';
      if (filteredItems.length === 0) {
        itemsContainer.innerHTML = '<p class="text-text-secondary col-span-full text-center">No items found.</p>';
        return;
      }
      filteredItems.forEach(item => {
        const div = document.createElement('div');
        div.className = 'bg-white rounded-2xl shadow-xl overflow-hidden card-hover animate-fade-in flex flex-col';
        div.innerHTML = `
          <div class="relative">
          <img src="${item.media ? item.media.url : '/images/logo.png'}" alt="${item.name}" class="h-48 w-full object-cover" />
            <div class="absolute top-4 right-4 bg-white bg-opacity-90 rounded-full p-2 shadow-md">
              <i class="fas fa-star text-yellow-400"></i>
            </div>
          </div>
          <div class="p-6 flex flex-col flex-grow">
            <h3 class="text-xl font-bold mb-2 text-gray-800">${item.name}</h3>
            <p class="text-gray-600 mb-4 line-clamp-2 flex-grow">${item.description || 'High-quality construction material'}</p>
            <div class="flex justify-between items-center">
              <span class="text-2xl font-extrabold text-purple-600">$${parseFloat(item.price).toFixed(2)}</span>
              <button data-id="${item.id}" class="add-to-cart-btn bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-2 rounded-full hover:from-purple-700 hover:to-pink-700 transition duration-300 transform hover:scale-105 shadow-lg">
                <i class="fas fa-cart-plus mr-2"></i>Add to Cart
              </button>
            </div>
          </div>
        `;
        itemsContainer.appendChild(div);
      });
      attachAddToCartListeners();
    }

    function filterAndSearch() {
      const searchTerm = searchInput.value.toLowerCase();
      const category = filterCategory.value;
      const filtered = items.filter(item => {
        const matchesSearch = item.name.toLowerCase().includes(searchTerm) || (item.description && item.description.toLowerCase().includes(searchTerm));
        const matchesCategory = category ? item.category === category : true;
        return matchesSearch && matchesCategory;
      });
      renderItems(filtered);
    }

    searchInput.addEventListener('input', filterAndSearch);
    filterCategory.addEventListener('change', filterAndSearch);

    function attachAddToCartListeners() {
      document.querySelectorAll('.add-to-cart-btn').forEach(button => {
        button.addEventListener('click', async () => {
          const itemId = button.getAttribute('data-id');
          button.disabled = true;
          button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Adding...';
          try {
            const response = await fetch('/shop/add-to-cart', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ item_id: itemId, quantity: 1 })
            });
            const result = await response.json();
            if (response.ok) {
              showToast('Item added to cart!', 'success');
              // Update cart count
              const cartCount = document.getElementById('cart-count');
              if (cartCount) {
                cartCount.textContent = parseInt(cartCount.textContent) + 1;
              }
            } else {
              showToast(result.error || 'Failed to add item', 'error');
            }
          } catch (error) {
            showToast('An error occurred', 'error');
          } finally {
            button.disabled = false;
            button.innerHTML = '<i class="fas fa-cart-plus mr-2"></i>Add to Cart';
          }
        });
      });
    }

    // Initial render
    renderItems(items);
  </script>
  <script src="/javascript/toast.js"></script>
</body>

</html>
